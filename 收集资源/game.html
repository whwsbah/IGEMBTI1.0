<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游戏页面</title>
</head>
<style>
    body {
    background: url("./ditu1.png") repeat;
    margin: 0;
    padding: 0;
}

#game-container {
    width: 100%;
    height: 100%;
    position: absolute;
}

.backgro {
    position: absolute;
    z-index: -999;
    height: 100%;
    width: 100%;
}

.logo {
    position: absolute;
    z-index: -998;
    height: 8vh;
    width: auto;
    left: 1%;
    top: 1vh;
}

.player {
    width: 4vw;
    height: 8vh;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    z-index: 444;
}

.resource {
    width: 6vw;
    height: 6vh;
    position: absolute;
}
.virus {
    width: 6vw;
    height: 6vh;
    position: absolute;
}

.nnn {
    width: 6vw;
    height: 6vh;
    position: absolute;
    display: none;
}
.dna {
    width: 6vw;
    height: 6vh;
    position: absolute;
}

.zhangai {
    width: 66px;
    height: 66px;
    position: absolute;
}

.resource1 {
    width: 6vh;
    height: auto;
    position: absolute;
}
.virus1 {
    width: 6vh;
    height: auto;
    position: absolute;
}
.dna1 {
    width: 6vh;
    height: auto;
    position: absolute;
}
.nnn1 {
    width: 6vh;
    height: auto;
    position: absolute;
}

.zhangai1 {
    position: absolute;
}

#scoreContainer {
    left: 16%;
    top: 1%;
    position: absolute;
    z-index: -990;
    font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
    font-size: 3rem;
    color: rgb(162, 193, 255);
    font-weight: 700;
}

#skill{
    width: 50%;
    float: right;
}
#skill img{
    width: 5vw;
    height: 5vw;
    z-index: 666;
    display: none;
    float: left;
    margin: 1vw;
}
/* #skill div{
    font-size: 4rem;
    color: orange;
    font-weight: 900;
    float: left;
    margin: 2%;
    display: none;
} */
.challenge-skill{
    width: 100%;
    display: flex;
    justify-content: space-evenly;
}
.challenge-skill img{
    width: 5vw;
    height: 5vw;
    z-index: 666;
    display: none;
}

/* .challenge-skill div{
    font-size: 5rem;
    color: orange;
    font-weight: 900;
    margin: 2%;
} */
.question-box{
    width: 60vw;
    height: 70vh;
    position: absolute;
    left: 20vw;
    top: 10vh;
    background-color: white;
    border-radius: 20px;
    border: 5px grey solid;
    z-index: 666; 
    display: none;
    padding: 2vw;
    font-size: 1rem;
}
.question-box div{
    margin: 1vw;
}
.question-box2{
    width: 60vw;
    height: 70vh;
    position: absolute;
    left: 20vw;
    top: 10vh;
    background-color: white;
    border-radius: 20px;
    border: 5px grey solid;
    z-index: 666; 
    display: none;
    padding: 3vw;
    font-size: 1rem;
}
.question-box2 div{
    margin: 1vw;
}
.dnaq-box{
    width: 100%;
    height: 30%;
}
#dna-q{
    width: 70%;
    position: relative;
    left: 15%;
    top: 30%;
}

.dnaq-box2{
    width: 100%;
    display: flex;
    justify-content: space-evenly;
}
.dnaq-box2 input{
    width: 70%;
}

</style>
<body>
    <div id="game-container">
        <img id="logo" class="logo" src="./logo.png">
        <img id="player" class="player" src="./player.png">
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./mei.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./mei.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./mei.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./mei.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./jiyin.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./jiyin.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./jiyin.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./jiyin.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./xinhao.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./xinhao.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./xinhao.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./xinhao.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./zhili.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./zhili.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./zhili.png">
        </div>
        <div id="resource" class="resource">
            <img id="resource1" class="resource1" src="./zhili.png">
        </div>
        <div id="zhangai" class="zhangai">
            <img id="zhangai1" class="zhangai1" style="width: 6vw;height: 12vh;" src="./zuoshang2.jpg">
        </div>
        <div id="zhangai" class="zhangai">
            <img id="zhangai1" class="zhangai1" style=" width: 9vw;height: 6vh;" src="./sange.jpg">
        </div>
        <div id="zhangai" class="zhangai">
            <img id="zhangai1" class="zhangai1" style="width: 3vw;height: 47vh;" src="./bage.jpg">
        </div>
        <div id="zhangai" class="zhangai">
            <img id="zhangai1" class="zhangai1" style="width: 6vw;height: 11.7vh;" src="./youxia2.jpg">
        </div>
        <div id="zhangai" class="zhangai">
            <img id="zhangai1" class="zhangai1" style="width: 9vw;height: 6vh;" src="./sange.jpg">
        </div>
        <div id="zhangai" class="zhangai">
            <img id="zhangai1" class="zhangai1" style="width: 3vw;height: 47vh;" src="./bage.jpg">
        </div>
        <div id="zhangai" class="zhangai">
            <img id="zhangai1" class="zhangai1" style="width: 9vw;height: 12vh;" src="./zuoshang.jpg">
        </div>
        <div id="zhangai" class="zhangai">
            <img id="zhangai1" class="zhangai1" style="width: 9vw;height: 12vh;" src="./youshang.jpg">
        </div>
        <div id="zhangai" class="zhangai">
            <img id="zhangai1" class="zhangai1" style="width: 9vw;height: 12vh;" src="./youxia.jpg">
        </div>
        <div id="zhangai" class="zhangai">
            <img id="zhangai1" class="zhangai1" style="width: 9vw;height: 12vh;" src="./zuoxia.jpg">
        </div>
        <div id="zhangai" class="zhangai">
            <img id="zhangai1" class="zhangai1" style="width: 17vw;height: 41vh;" src="./tu3.jpg">
        </div>
        <div id="scoreContainer">成长值：<span id="score">0</span></div>
        <div id="skill">
            <img alt="" id="e">
            <img alt="" id="n">
            <img alt="" id="s">
            <img alt="" id="p">
        </div>
        <div id="virus" class="virus">
            <img id="virus1" class="virus1" src="./病毒.png">
        </div>
        <div id="virus" class="virus">
            <img id="virus1" class="virus1" src="./病毒.png">
        </div>
        <div id="dna" class="dna">
            <img id="dna1" class="dna1" src="./受损DNA.png">
        </div>
        <div id="dna" class="dna">
            <img id="dna1" class="dna1" src="./受损DNA.png">
        </div>

        <div id="nnn" class="nnn">
            <img id="nnn1" class="nnn1" src="./xinhao.png">
        </div>
        <div id="nnn" class="nnn">
            <img id="nnn1" class="nnn1" src="./zhili.png">
        </div>
        <div id="nnn" class="nnn">
            <img id="nnn1" class="nnn1" src="./mei.png">
        </div>
        <div id="nnn" class="nnn">
            <img id="nnn1" class="nnn1" src="./jiyin.png">
        </div>

        <div class="question-box">
            <div id="question"></div>
            <div id="option">
                <div class="opt"></div>
                <div class="opt"></div>
                <div class="opt"></div>
                <div class="opt"></div>
            </div>
            <div id="explain"></div>
            <div class="challenge-skill">
                <img alt="" id="j">
                <img alt="" id="f">
            </div>
        </div>
        <div class="question-box2">
            <div id="question2"></div>
            <div class="dnaq-box">
                <img alt="" id="dna-q">
            </div>
            <div class="dnaq-box2">
                <input type="text" id="dna-answer" autocomplete="off">
                <button id="jianjixulie">确定</button>
            </div>
            <div class="challenge-skill">
                <img alt="" id="j2">
                <img alt="" id="f2">
            </div>
        </div>
    </div>

    <script>
        // 接收mbti参数
        var loc=location.href;
        var n1=loc.length;//地址的总长度
        var n2=loc.indexOf("=");//取得=号的位置
        var id=decodeURI(loc.substr(n2+1, n1-n2));//从=号后面的内容
        // console.log(id)

        // 判断mbti技能有哪些
        var mbtiskills = id.split("")
        // console.log(mbtiskills)
        const e = document.getElementById("e")
        for (var i = 0; i < 4; i++) {
            if(mbtiskills[i] == "E"){
                e.style.display = "block"
                e.src = "./加速.png"
            }
            // if(mbtiskills[i] == "I"){
            //     i.style.display = "block"
            //     i.src = "./盾牌图标.png"
            // }
            if(mbtiskills[i] == "S"){
                s.style.display = "block"
                s.src = "./磁铁.png"
            }
            if(mbtiskills[i] == "N"){
                n.style.display = "block"
                n.src = "./洞察.png"
            }
            // if(mbtiskills[i] == "T"){
            //     t.style.display = "block"
            //     t.src = "./逻辑分析.png"
            // }
            if(mbtiskills[i] == "F"){
                f.style.display = "block"
                f.src = "./情绪稳定.png"
                f2.style.display = "block"
                f2.src = "./情绪稳定.png"
            }
            if(mbtiskills[i] == "P"){
                p.style.display = "block"
                p.src = "./适应变通.png"
            }
            if(mbtiskills[i] == "J"){
                j.style.display = "block"
                j.src = "./即时决策.png"
                j2.style.display = "block"
                j2.src = "./即时决策.png"
            }
        }


        // 正式游戏部分
        const gameContainer = document.getElementById("game-container");
        const player = document.getElementById("player");
        const shuzhi1 = document.getElementById("shuzhi");
        /*障碍物位置*/
        let zhangais = [
            { x: 5.8, y: 11.5, type: "zhangai" },
            { x: 20.5, y: 11.7, type: "zhangai" },
            { x: 41.2, y: 12, type: "zhangai" },
            { x: 38.3, y: 76.3, type: "zhangai" },
            { x: 20.6, y: 82.3, type: "zhangai" },
            { x: 5.9, y: 41.3, type: "zhangai" },
            { x: 52.7, y: 46.9, type: "zhangai" },
            { x: 64.5, y: 46.9, type: "zhangai" },
            { x: 64.5, y: 76.2, type: "zhangai" },
            { x: 52.8, y: 76.2, type: "zhangai" },
            { x: 82, y: 0, type: "zhangai" },
        ]
        /*障碍物显示*/
        function displayzhangais() {
            zhangais.forEach(zhangai => {
                const zhangaiElement = document.getElementById("zhangai");
                zhangaiElement.style.top = `${zhangai.y}vh`;
                zhangaiElement.style.left = `${zhangai.x}vw`;
                gameContainer.appendChild(zhangaiElement);
            });
        }
        /*检查是否撞到障碍物，若撞到返回失败页面*/
        function checkForzhangaiCollection() {
            zhangais.forEach((zhangai, index1) => {
                const playerRect = player.getBoundingClientRect();
                const zhangaiRect = document.getElementsByClassName("zhangai1")[index1].getBoundingClientRect();

                if (playerRect.left < zhangaiRect.right &&
                    playerRect.right > zhangaiRect.left &&
                    playerRect.top < zhangaiRect.bottom &&
                    playerRect.bottom > zhangaiRect.top) {
                    window.open("./fail.html"+"?txt="+encodeURI(id));
                    window.close("game.html")
                    return;
                }
            });
        }
        /*资源点位置*/
        let resources = [
            { x: 12, y: 20, type: "Gene Fragment" },
            { x: 56, y: 15, type: "Gene Fragment" },
            { x: 60, y: 68, type: "Gene Fragment" },
            { x: 36, y: 36, type: "Gene Fragment" },
            { x: 93, y: 22, type: "Enzyme Resource" },
            { x: 48, y: 90, type: "Enzyme Resource" },
            { x: 52, y: 65, type: "Enzyme Resource" },
            { x: 75, y: 80, type: "Enzyme Resource" },
            { x: 21, y: 42, type: "Plasmid Point" },
            { x: 49, y: 80, type: "Plasmid Point" },
            { x: 56, y: 40, type: "Plasmid Point" },
            { x: 22, y: 69, type: "Plasmid Point" },
            { x: 90, y: 79, type: "Signal Molecule" },
            { x: 11, y: 69, type: "Signal Molecule" },
            { x: 32, y: 19, type: "Signal Molecule" },
            { x: 30, y: 11, type: "Signal Molecule" },
        ];
        /*资源点显示*/
        function displayResources() {
            resources.forEach(resource => {
                const resourceElement = document.getElementById("resource");
                resourceElement.style.top = `${resource.y}vh`;
                resourceElement.style.left = `${resource.x}vw`;
                gameContainer.appendChild(resourceElement);
            });
        }
        /*病毒位置*/
        let viruses = [
            { x: 18, y: 33, type: "virus" },
            { x: 79, y: 69, type: "virus" },
        ]
        function displayviruses() {
            viruses.forEach(virus => {
                const virusElement = document.getElementById("virus");
                virusElement.style.top = `${virus.y}vh`;
                virusElement.style.left = `${virus.x}vw`;
                gameContainer.appendChild(virusElement);
            });
        }
        /*DNA位置*/
        let dnas = [
            { x: 68, y: 16, type: "dna" },
            { x: 33, y: 61, type: "dna" },
        ]
        function displaydnas() {
            dnas.forEach(dna => {
                const dnaElement = document.getElementById("dna");
                dnaElement.style.top = `${dna.y}vh`;
                dnaElement.style.left = `${dna.x}vw`;
                gameContainer.appendChild(dnaElement);
            });
        }
        /*技能n中增加的资源点位置*/
        let nnns = [
            { x: 108, y: 101, type: "nnn" },
            { x: 83, y: 111, type: "nnn" },
            { x: 12, y: 107, type: "nnn" },
            { x: 103, y: 61, type: "nnn" },
        ]
        function displaynnns() {
            nnns.forEach(nnn => {
                const nnnElement = document.getElementById("nnn");
                nnnElement.style.display = `block`;
                nnnElement.style.top = `${nnn.y}vh`;
                nnnElement.style.left = `${nnn.x}vw`;
                gameContainer.appendChild(nnnElement);
            });
        }


        // 调用位置函数
        displayzhangais();
        displayResources();
        displayviruses();
        displaydnas();
        // displaynnns();


        /*玩家移动*/
        function movePlayer(x, y) {
            player.style.left = `${x}px`;
            player.style.top = `${y}px`;
        }


        // 技能p挑战点变资源点
        // var p = document.querySelector(".p")
        var flag_p = false
        // 设置样式
        p.addEventListener("click", ()=> {
            flag_p = true
            var imgv = document.querySelectorAll('.virus1')
            imgv[0].src = "./zhili.png"
            imgv[1].src = "./zhili.png"
            var imgd = document.querySelectorAll('.dna1')
            imgd[0].src = "./mei.png"
            imgd[1].src = "./mei.png"
        })
        // 碰到挑战点加分
        function pvirus(){
            viruses.forEach((virus, index) => {
                const playerRect = player.getBoundingClientRect();
                const virusRect = document.querySelectorAll(".virus")[index].getBoundingClientRect();
                if (playerRect.left < virusRect.right &&
                    playerRect.right > virusRect.left &&
                    playerRect.top < virusRect.bottom &&
                    playerRect.bottom > virusRect.top){
                    let currentScore = parseInt(document.getElementById("score").textContent, 10);
                    currentScore += 10;
                    document.getElementById("score").textContent = currentScore;
                    viruses.splice(index, 1);
                    document.querySelectorAll(".virus")[index].remove();
                    if (currentScore >= 60) {
                        window.open("./jinhuaORtiaozhan.html"+"?txt="+encodeURI(id));
                        return;
                    }
                }
            });
        }
        function pdna(){
            dnas.forEach((dna, index) => {
                const playerRect = player.getBoundingClientRect();
                const dnaRect = document.querySelectorAll(".dna")[index].getBoundingClientRect();
                if (playerRect.left < dnaRect.right &&
                    playerRect.right > dnaRect.left &&
                    playerRect.top < dnaRect.bottom &&
                    playerRect.bottom > dnaRect.top){
                    let currentScore = parseInt(document.getElementById("score").textContent, 10);
                    currentScore += 10;
                    document.getElementById("score").textContent = currentScore;
                    dnas.splice(index, 1);
                    document.querySelectorAll(".dna")[index].remove();
                    if (currentScore >= 60) {
                        window.open("./jinhuaORtiaozhan.html"+"?txt="+encodeURI(id));
                        return;
                    }
                }
            });
        }


        // n:显示更多地图信息
        // var n = document.querySelector(".n")
        var flag_n = false
        n.addEventListener("click", ()=> {
            flag_n = true
            gameContainer.style.transform='scale(0.8,0.8)'
            gameContainer.style.transformOrigin='top left'
            gameContainer.style.width = 110+"%"
            gameContainer.style.height = 110+"%"
            player.style.left = 47+"vw";
            player.style.top = 50+"vh";
            // 调用nnn位置
            displaynnns()
        })
        function checkFornnn() {
            nnns.forEach((nnn, index) => {
                const playerRect = player.getBoundingClientRect();
                const nnnRect = document.getElementsByClassName("nnn")[index].getBoundingClientRect();

                if (playerRect.left < nnnRect.right &&
                    playerRect.right > nnnRect.left &&
                    playerRect.top < nnnRect.bottom &&
                    playerRect.bottom > nnnRect.top) {
                    let currentScore = parseInt(document.getElementById("score").textContent, 10);
                    currentScore += 10;
                    document.getElementById("score").textContent = currentScore;
                    nnns.splice(index, 1);
                    document.getElementsByClassName("nnn")[index].remove();
                    if (currentScore >= 60) {
                        window.open("./jinhuaORtiaozhan.html"+"?txt="+encodeURI(id));
                        return;
                    }
                }
            });
        }




        /*检查资源点收集，收集到资源点，资源点消失，左上方成长值加10*/
        // s:磁铁
        // var s = document.querySelector(".s")
        var flag_s = false
        s.addEventListener("click", ()=> {
            flag_s = true
        })
        function checkForResourceCollection() {
            resources.forEach((resource, index) => {
                const playerRect = player.getBoundingClientRect();
                const resourceRect = document.getElementsByClassName("resource")[index].getBoundingClientRect();

                if (playerRect.left < resourceRect.right &&
                    playerRect.right > resourceRect.left &&
                    playerRect.top < resourceRect.bottom &&
                    playerRect.bottom > resourceRect.top) {
                    let currentScore = parseInt(document.getElementById("score").textContent, 10);
                    currentScore += 10;
                    document.getElementById("score").textContent = currentScore;
                    resources.splice(index, 1);
                    document.getElementsByClassName("resource")[index].remove();
                    if (currentScore >= 60) {
                        window.open("./jinhuaORtiaozhan.html"+"?txt="+encodeURI(id));
                        return;
                    }
                }
            });
        }
        function checkForResourceCollection2() {
            resources.forEach((resource, index) => {
                const playerRect = player.getBoundingClientRect();
                const resourceRect = document.getElementsByClassName("resource")[index].getBoundingClientRect();
                // 技能n改变资源点消失距离
                if (playerRect.left < resourceRect.right+50 &&
                    playerRect.right > resourceRect.left-50 &&
                    playerRect.top < resourceRect.bottom+50 &&
                    playerRect.bottom > resourceRect.top-50) {
                    let currentScore = parseInt(document.getElementById("score").textContent, 10);
                    currentScore += 10;
                    document.getElementById("score").textContent = currentScore;
                    resources.splice(index, 1);
                    document.getElementsByClassName("resource")[index].remove();
                    if (currentScore >= 60) {
                        window.open("./jinhuaORtiaozhan.html"+"?txt="+encodeURI(id));
                        return;
                    }
                }
            });
        }


        // 病毒挑战
        // j:跳过题目
        // var j = document.querySelector(".j")
        j.addEventListener("click", ()=> {
            const questionbox = document.querySelector(".question-box");
            questionbox.style.display = "none"
        })
        // f：答错不扣除资源点
        // var f = document.querySelector(".f")
        var flag_f = false
        f.addEventListener("click", ()=> {
            flag_f = true
        })

        // 病毒挑战问题
        function viruschallenge(){
            const questions = [
                { question: "在你的微观世界探险中，你的微形态遭遇了一个病毒的突袭。这个病毒实验室存储了关于病毒潜在应用和危害的数据，提供了一个紧急的测试你对病毒知识的理解的机会。为了保护你的微形态并充分利用这些病毒，你需要正确评估病毒的生物学和医学应用。在这场病毒突袭中，病毒的不同利用方式被测试。你需要快速辨别下列关于病毒在生物医学领域的应用中，哪个叙述是错误的：", 
                option: ["A. 经过灭活或减毒处理的病毒可以被用作免疫预防，提升机体的防御能力。", "B. 灭活的病毒可以被用于促进动物细胞间的融合，这是一种实验室研究技术。", "C. 特定病毒的免疫可以在小鼠体内用来制备单克隆抗体，这是现代医学的一项重要成就。", "D. 在基因工程中，噬菌体常用于转化植物细胞，这是一种常见的生物技术。"], 
                explain:["选择错误的叙述将帮助你的微形态避免使用不合适的技术，并确保在这场病毒突袭中采取正确的防御措施。"],
                key: 3 },
            ];
            const questionbox = document.querySelector(".question-box");
            const question = document.getElementById("question");
            const option = document.getElementById("option");
            const explain = document.getElementById("explain");
            const Question = questions[0];
            const key = Question.key;

            questionbox.style.display = "block"
            question.textContent = Question.question;
            explain.textContent = Question.explain;
            option.innerHTML = "";

            Question.option.forEach((opt, answer) => {
                const button = document.createElement("button");     
                button.textContent = opt;
                button.style.margin = 1+"vw"
                button.style.fontSize =1+"rem"
                button.style.width =100+"%"
                button.style.textAlign ="left"
                option.appendChild(button);

                button.onclick = function () {
                    let currentScore = parseInt(document.getElementById("score").textContent, 10);
                    // 判断答案：答对+20，答错有f技能+0，答错无f技能-20
                    if (answer==key) {
                        // console.log("hhh")
                        currentScore += 20;
                        document.getElementById("score").textContent = currentScore;  
                        questionbox.style.display = "none"      
                    } else if(flag_f){
                        currentScore += 0;
                        document.getElementById("score").textContent = currentScore; 
                        questionbox.style.display = "none"             
                    }else{
                        currentScore -= 20;
                        document.getElementById("score").textContent = currentScore;
                        questionbox.style.display = "none"              
                    };
                }
            });
        }

        // 判断与病毒的距离
        function checkForvirus() {
            viruses.forEach((virus, index) => {
                const playerRect = player.getBoundingClientRect();
                const virusRect = document.getElementsByClassName("virus")[index].getBoundingClientRect();
                if (playerRect.left < virusRect.right &&
                    playerRect.right > virusRect.left &&
                    playerRect.top < virusRect.bottom &&
                    playerRect.bottom > virusRect.top) {
                        console.log(222)         
                    viruschallenge();
                    let currentScore = parseInt(document.getElementById("score").textContent, 10);
                    viruses.splice(index, 1);
                    document.getElementsByClassName("virus")[index].remove();

                    if (currentScore >= 60) {
                        window.open("./jinhuaORtiaozhan.html"+"?txt="+encodeURI(id));
                        return;
                    }
                }
            });
        }

        // 受损DNA挑战
        // j:跳过题目
        // var j2 = document.querySelector(".j2")
        j2.addEventListener("click", ()=> {
            const questionbox2 = document.querySelector(".question-box2");
            questionbox2.style.display = "none"
        })
        // f：答错不扣除资源点
        // var f2 = document.querySelector(".f2")
        var flag_f2 = false
        f2.addEventListener("click", ()=> {
            flag_f2 = true
        })

        // DNA挑战问题
        function dnachallenge(){
            const questions = [
                { question: "在DNA复制过程中，DNA受到损伤，以下为受损DNA片段的一条链，请根据碱基互补配对原则，正确输入互补链的碱基序列（相邻碱基之间请不要添加空格、回车以及标点符号）", 
                key: "AGGCCCCTTCCAACCAGGCA" },
            ];
            const questionbox2 = document.querySelector(".question-box2");
            const question2 = document.getElementById("question2");
            const dnaq = document.getElementById("dna-q");
            const button2 = document.getElementById("jianjixulie")
            const Question = questions[0];
            const key = Question.key;

            questionbox2.style.display = "block"
            question2.textContent = Question.question;
            dnaq.src = "./碱基1.png"


                button2.onclick = function () {
                    const answer = document.getElementById("dna-answer").value
                    // console.log(answer)

                    let currentScore = parseInt(document.getElementById("score").textContent, 10);
                    // 判断答案：答对+20，答错有f技能+0，答错无f技能-20
                    if (answer==key) {
                        // console.log("hhh")
                        currentScore += 20;
                        document.getElementById("score").textContent = currentScore;  
                        questionbox2.style.display = "none"      
                    } else if(flag_f2){
                        currentScore += 0;
                        document.getElementById("score").textContent = currentScore; 
                        questionbox2.style.display = "none"             
                    }else{
                        currentScore -= 20;
                        document.getElementById("score").textContent = currentScore;
                        questionbox2.style.display = "none"              
                    };
                }
        }

        // 判断与DNA的距离
        function checkFordna() {
            dnas.forEach((dna, index) => {
                const playerRect = player.getBoundingClientRect();
                const dnaRect = document.getElementsByClassName("dna")[index].getBoundingClientRect();
                if (playerRect.left < dnaRect.right &&
                    playerRect.right > dnaRect.left &&
                    playerRect.top < dnaRect.bottom &&
                    playerRect.bottom > dnaRect.top) {
                    dnachallenge();
                    let currentScore = parseInt(document.getElementById("score").textContent, 10);
                    dnas.splice(index, 1);
                    document.getElementsByClassName("dna")[index].remove();

                    if (currentScore >= 60) {
                        window.open("./jinhuaORtiaozhan.html"+"?txt="+encodeURI(id));
                        return;
                    }
                }
            });
        }


        /*键盘控制玩家移动、玩家形象随运动方向切换*/
        // e:加速
        // var e = document.querySelector(".e")
        var flag_e = false
        e.addEventListener("click", ()=> {
            flag_e = true
        })
        document.addEventListener("keydown", (event) => {
            if(flag_e){
                // alert(11)
                // 技能e改变speed值
                const speed = 25;
                const playerright = document.getElementById("player");
                switch (event.key) {
                    case "ArrowUp":
                        movePlayer(player.offsetLeft, player.offsetTop - speed);
                        playerright.src = './playerup.png';
                        break;
                    case "ArrowDown":
                        movePlayer(player.offsetLeft, player.offsetTop + speed);
                        playerright.src = './playerdown.png';
                        break;
                    case "ArrowLeft":
                        movePlayer(player.offsetLeft - speed, player.offsetTop);
                        playerright.src = './player.png';
                        break;
                    case "ArrowRight":
                        movePlayer(player.offsetLeft + speed, player.offsetTop);
                        playerright.src = './playerright.png';
                        break;
                }
            }else{
                const speed = 10;
                const playerright = document.getElementById("player");
                switch (event.key) {
                    case "ArrowUp":
                        movePlayer(player.offsetLeft, player.offsetTop - speed);
                        playerright.src = './playerup.png';
                        break;
                    case "ArrowDown":
                        movePlayer(player.offsetLeft, player.offsetTop + speed);
                        playerright.src = './playerdown.png';
                        break;
                    case "ArrowLeft":
                        movePlayer(player.offsetLeft - speed, player.offsetTop);
                        playerright.src = './player.png';
                        break;
                    case "ArrowRight":
                        movePlayer(player.offsetLeft + speed, player.offsetTop);
                        playerright.src = './playerright.png';
                        break;
            }
            
        }

        // 是否调用技能s
        if(!flag_s){
            checkForResourceCollection();
        }else{
            checkForResourceCollection2();
        }

        checkForzhangaiCollection();
        checkForvirus();
        checkFordna();

        // 是否调用技能p
        if(flag_p){
            pvirus();
            pdna();
        }
        // 是否调用技能n
        if(flag_n){
            checkFornnn();
        }

        });


    </script>
</body>
</html>